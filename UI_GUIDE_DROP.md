# 軍儀 UI - 「新」（持ち駒配置）の使い方

## 🎮 UIで「新」をする方法

### ステップ1: 持ち駒を選択

1. **自分の番**になったら、画面左右に表示される**持ち駒エリア**を確認
   - 先手（黒）：画面右側
   - 後手（白）：画面左側

2. **配置したい駒をクリック**
   - 持ち駒がハイライトされ、選択状態になります
   - 例: 「兵 × 1」をクリック

### ステップ2: 配置場所を選択

1. 盤面上に**緑色のハイライト**が表示されます
   - 緑色のマスは配置可能な場所です

2. **配置したい場所をクリック**
   - 駒が配置されます
   - 手番が相手に移ります

### ステップ3: 選択を解除（任意）

- **同じ駒をもう一度クリック**すると選択解除できます
- **別の駒をクリック**すると、そちらに切り替わります

---

## 🎯 実際の操作例

### 例1: 兵を配置する

```
1. 「兵 × 1」をクリック
   → 兵が青く光る
   → 盤面に配置可能な場所が緑色に

2. 緑色のマス（例: 7行5列）をクリック
   → 兵が配置される
   → 「兵を配置しました」とメッセージ表示
   → 手番が交代
```

### 例2: 味方の駒の上に槍を配置（スタックを作る）

```
1. 「槍 × 2」をクリック
   → 槍が選択される

2. 既に自分の駒がある場所（緑色）をクリック
   → 槍が既存の駒の上に積まれる
   → スタックが形成される（例: 兵/槍）
```

---

## ✅ 配置できる条件

持ち駒を配置するには、以下の条件を満たす必要があります：

| 条件 | 説明 |
|------|------|
| ✓ 持ち駒がある | その駒を持っている |
| ✓ 自分の番 | 現在のプレイヤーが自分 |
| ✓ 最前線より後ろ | 敵寄りには置けない |
| ✓ 配置可能な場所 | 緑色でハイライトされた場所 |

---

## ❌ よくあるエラーと対処法

### エラー: 「そこには配置できません」

**原因:**
- 緑色でハイライトされていない場所をクリックした
- 最前線より前（敵寄り）に配置しようとした
- 帥の上、敵の駒の上に配置しようとした

**対処法:**
- 緑色の場所のみクリックしてください

### エラー: 「相手の持ち駒は使えません」

**原因:**
- 相手の持ち駒をクリックした

**対処法:**
- 自分の持ち駒（現在の手番のプレイヤー）をクリックしてください

### 持ち駒がクリックできない

**原因:**
- 相手の番
- 持ち駒が0枚

**対処法:**
- 自分の番まで待つ
- 持ち駒がある駒を選択する

---

## 🎨 視覚的なフィードバック

### 持ち駒の表示

| 状態 | 表示 |
|------|------|
| 通常 | 白背景、グレーの枠 |
| クリック可能 | マウスオーバーで青く光る |
| 選択中 | 青背景、白文字、太字 |

### 盤面の表示

| 状態 | 表示 |
|------|------|
| 配置可能 | 緑色のハイライト |
| 配置済み | 駒が表示される |
| スタック | 駒が縦に重なって表示 + 数字 |

---

## 📱 操作の流れ（全体）

```
新しいゲーム開始
    ↓
先手（黒）の番
    ↓
① 盤上の駒を動かす  OR  ② 持ち駒を配置（新）
    ↓                      ↓
駒を選択 → 移動先クリック   持ち駒クリック → 配置先クリック
    ↓                      ↓
手番交代 ←─────────────────┘
    ↓
後手（白）の番
    ↓
（繰り返し）
```

---

## 💡 便利な機能

### 選択解除
- 同じ駒/持ち駒をもう一度クリック
- 別の駒を選択
- 盤面の空白をクリック

### 合法手の確認
- 駒や持ち駒を選択すると、自動的に配置/移動可能な場所が緑色で表示されます

### メッセージ表示
- 画面下部に操作の結果が表示されます
- 緑: 成功
- 黄: 警告
- 赤: エラー

---

## 🚀 クイックスタート

1. **サーバー起動**
   ```bash
   python run_server.py
   ```

2. **ブラウザで開く**
   ```
   http://localhost:8003/
   ```

3. **「新しいゲーム」ボタンをクリック**

4. **持ち駒をクリックして、緑色の場所に配置！**

---

## 🎓 ヒント

### 初心者向け
- まずは空いている場所に配置してみましょう
- 緑色の場所だけがクリックできます
- 持ち駒の選択はいつでも解除できます

### 中級者向け
- 味方の駒の上に配置してスタックを作りましょう
- スタックレベルが上がると駒が強化されます
- 最前線の制限に注意しましょう

### 上級者向け
- 戦略的な配置で戦局を有利に
- スタックを活用した立体的な戦術
- 相手の動きを予測した配置

---

## 📚 関連ドキュメント

- **QUICK_GUIDE_DROP.md** - 詳細な使い方
- **HOW_TO_DROP_PIECES.md** - APIでの使い方
- **test_drop_api.py** - テストスクリプト

---

## ❓ トラブルシューティング

### 持ち駒が表示されない
→ 初期配置で全て盤上に配置している可能性があります

### クリックしても反応しない
→ F12キーでコンソールを開いて、エラーメッセージを確認してください

### 盤面が更新されない
→ ブラウザを更新（F5）してみてください

---

**持ち駒を戦略的に配置して、軍儀の勝利を目指しましょう！** 🎉
